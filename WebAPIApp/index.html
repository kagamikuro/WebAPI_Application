<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Book System App</title>
    <link href="bootstrap.min.css" rel="stylesheet">

    <style type="text/css">
        #addbook{
            width:400px;
        }

        #editBook {
            width: 400px;
        }

        .form-control{
            width:300px;
        }

        #bookTable {
            width: 500px;
        }
    </style>

    <script type="text/javascript">
        function openEditWin() {
            window.open("edit.html", "newwindow", "height=300, width=400, toolbar=no,menubar=no, scrollbars=no, resizable=no, location=no, status=no");
        }
    </script>

</head>
<body>
    <h1 class="display-1">Book System App</h1>

    <h2 class="font-weight-normal">Add books</h2>

    <div style="padding: 10px 10px 10px;" id="addbook">
        <form class="bs-example bs-example-form" role="form">
            <div class="input-group">
                <span class="input-group-addon">book name:</span>
                <input type="text" class="form-control" id="name">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">book type:</span>
                <input type="text" class="form-control" id="type">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">rate:</span>
                <input type="text" class="form-control" id="rate">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">price:</span>
                <input type="text" class="form-control" id="price">
            </div>
            <br>
            <div class="input-group">
                <input class="btn btn-primary" type="button" id="btnAdd" value="add" />
            </div>
        </form>
    </div>

    <div>
        <h2 class="font-weight-normal">Search by Book Name</h2>
        <input type="text" class="form-control" id="bookName" size="5" width="300" />
        <input type="button" class="btn btn-primary" value="Search" id="btnFind" />
        <p id="book" />
    </div>

    <div>
        <h2 class="font-weight-normal">Delete by Book Name</h2>
        <input type="text" class="form-control" id="bookName2" size="5" width="300" />
        <input type="button" class="btn btn-primary" value="Delete" id="btnDelete" />
    </div>


    <h2 class="font-weight-normal">Edit books</h2>

    <div style="padding: 10px 10px 10px;" id="editBook">
        <form class="bs-example bs-example-form" role="form">
            <div class="input-group">
                <span class="input-group-addon">book name:</span>
                <input type="text" class="form-control" id="name2">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">book type:</span>
                <input type="text" class="form-control" id="type2">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">rate:</span>
                <input type="text" class="form-control" id="rate2">
            </div>
            <br>
            <div class="input-group">
                <span class="input-group-addon">price:</span>
                <input type="text" class="form-control" id="price2">
            </div>
            <br>
            <div class="input-group">
                <input class="btn btn-primary" type="button" id="edit" value="edit" />
            </div>
        </form>
    </div>

    <div>
        <h2 class="font-weight-normal">All Books</h2>
        <ul id="books" />
    </div>


    <div>
        <table border="1" id="bookTable" class="table table-hover">

            <caption>book detail</caption>

            <thead>
            </thead>

            <tbody>
            </tbody>
        </table>
    </div>

    <script src="jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(getAll());


        function getAll() {
            $('#books').html('');
            $("#bookTable").children("thead").html("");
            $("#bookTable").children("tbody").html("");


            var row = document.createElement('tr');

            var nameCell = document.createElement('th');
            nameCell.innerHTML = "Book Name";
            row.appendChild(nameCell);

            var typeCell = document.createElement('th');
            typeCell.innerHTML = "Type";
            row.appendChild(typeCell);

            var rateCell = document.createElement('th');
            rateCell.innerHTML = "Rate";
            row.appendChild(rateCell);

            var priceCell = document.createElement('th');
            priceCell.innerHTML = "Price";
            row.appendChild(priceCell);

            var editCell = document.createElement('th');
            editCell.innerHTML = "Edit"
            row.appendChild(editCell);


            var delCell = document.createElement('th');
            delCell.innerHTML = "Delete"
            row.appendChild(delCell);


            $("#bookTable").children("thead").append(row);

            $.ajax({
                url: "api/Books",
                type: 'GET',
                success: function (data) {
                    $.each(data, function (key, item) {
                        // Add a list item for the product.
                        $('<li>', { text: formatItem(item) }).appendTo($('#books'));

                        var row = document.createElement('tr');

                        var nameCell = document.createElement('th');
                        nameCell.innerHTML = item.Name;
                        nameCell.setAttribute("class", "bookname");
                        row.appendChild(nameCell);

                        var typeCell = document.createElement('th');
                        typeCell.innerHTML = item.Category;
                        row.appendChild(typeCell);

                        var rateCell = document.createElement('th');
                        rateCell.innerHTML = item.Rate;
                        row.appendChild(rateCell);

                        var priceCell = document.createElement('th');
                        priceCell.innerHTML = "$" + item.Price;
                        row.appendChild(priceCell);

                        var editCell = document.createElement('th');
                        row.appendChild(editCell);
                        var btnEdit = document.createElement('input');
                        btnEdit.setAttribute('type', 'button');
                        btnEdit.setAttribute('value', 'edit');
                        btnEdit.setAttribute('class', 'btn btn-primary');
                        btnEdit.setAttribute('id', 'btnEdit');
                        btnEdit.setAttribute('onclick', 'openEditWin()');
                        editCell.appendChild(btnEdit);

                        var delCell = document.createElement('th');
                        row.appendChild(delCell);
                        var btnDel = document.createElement('input');
                        btnDel.setAttribute('type', 'button');
                        btnDel.setAttribute('value', 'delete');
                        btnDel.setAttribute('class', 'btn btn-primary btnDel');

                        delCell.appendChild(btnDel);

                        $("#bookTable").children("tbody").append(row);
                    });
                }
            });

        }


        function formatItem(item) {
            return "book name:[" + item.Name + "] book type:[" + item.Category + "] book rate:[" + item.Rate + '] price: $' + item.Price;
        }

        $("#btnFind").click(function () {
            var id = $('#bookName').val();
            console.log(id);
            $.ajax({
                url: "api/Books/" + id,
                type: 'GET',
                success: function (data) {
                    //$("#book").text(formatItem(data));
                    $("#book").text(formatItem(data));
                },
                error: function (e) {
                    $("#book").text("book not found!");
                }
            });
        });


        $("#btnAdd").click(function () {
            var _data = { "Name": $("#name").val(), "Category": $("#type").val(), "Rate": $("#rate").val(), "Price": $("#price").val() };
            var name = $("#name").val();
            $.ajax({
                url: "api/Books/",
                type: "POST",
                data: _data,
                success: function (data) {
                    alert("add book [" + name + "] successfully");
                    getAll();
                },
                error: function (e) {
                    alert("add book [" + name + "] fail");
                    alert(e.responseText);
                }
            });
        });

        $("#btnDelete").click(function () {
            var name = $("#bookName2").val();

            $.ajax({
                url: "api/Books/" + name,
                type: 'DELETE',
                success: function (data) {
                    alert("delete book [" + name + "] successfully");
                    getAll();
                }
            });
        });

        $(".btnDel").click(function () {
            console.log("btnDel click function called");
            var name = $(this).parent().children(".bookname");

            $.ajax({
                url: "api/Books/" + name,
                type: 'DELETE',
                success: function (data) {
                    alert("delete book [" + name + "] successfully");
                    getAll();
                }
            });
        });


        $("#edit").click(function () {
            var _data = { "Name": $("#name2").val(), "Category": $("#type2").val(), "Rate": $("#rate2").val(), "Price": $("#price2").val() };
            var name = $("#name2").val();
            $.ajax({
                url: "api/Books/",
                type: "PUT",
                data: _data,
                success: function (data) {
                    alert("edit book [" + name + "] successfully");
                    getAll();
                },
                error: function (e) {
                    alert("no this book!");
                    alert(e.responseText);
                }
            });
        });

    </script>
</body>
</html>